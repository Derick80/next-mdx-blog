import Link from 'next/link'
import { MDXRemote } from 'next-mdx-remote/rsc'
import { highlight } from 'sugar-high'
import React from 'react'
import { H1 } from './typography/typography';
interface TableData {
    headers: string[];
    rows: string[][];
}

interface TableProps {
    data: TableData;
}
function Table ({ data }: TableProps) {
    let headers = data.headers.map((header, index) => (
        <th key={ index }>{ header }</th>
    ))
    let rows = data.rows.map((row, index) => (
        <tr key={ index }>
            { row.map((cell, cellIndex) => (
                <td key={ cellIndex }>{ cell }</td>
            )) }
        </tr>
    ))

    return (
        <table>
            <thead>
                <tr>{ headers }</tr>
            </thead>
            <tbody>{ rows }</tbody>
        </table>
    )
}

function CustomLink (props) {
    let href = props.href

    if (href.startsWith('/')) {
        return (
            <Link href={ href } { ...props }>
                { props.children }
            </Link>
        )
    }

    if (href.startsWith('#')) {
        return <a { ...props } />
    }

    return <a target="_blank" rel="noopener noreferrer" { ...props } />
}




function Code ({ children, ...props }) {
    let codeHTML = highlight(children)
    return <code dangerouslySetInnerHTML={ { __html: codeHTML } } { ...props } />
}



let components = {
    a: CustomLink,
    code: Code,
    Table,
    h1: <H1 />,
}

export function CustomMDX (props) {
    return (
        <MDXRemote
            { ...props }
            components={ { ...components, ...(props.components || {}) } }
        />
    )
}